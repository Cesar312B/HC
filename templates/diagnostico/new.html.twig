{% extends 'base.html.twig' %}

{% block title %}Nuevo Diagnóstico{% endblock %}

{% block body %}

<div class="card-body p-5 bg-white rounded">
{% for flash_message in app.session.flashbag.get('exito') %}
    <div class="flash-notice">
        {{ flash_message }}
    </div>
{% endfor %}
 {{ include('full_antecedentes/ant_base.html.twig') }}
<!-- Button trigger modal -->


 {{ form_start(form) }}
<h4 class="text-primary">Detalles de diagnóstico</h4>
<div class="row">

   <div class="col-md-12">
    {{ form_row(form.cie) }}
  </div>
  
  <div class="col-md-6">
    {{ form_row(form.tipo_diagnostico,{
           attr: {      
            'label': 'Tipo de diagnóstico',  
            'placeholder': 'Seleccione Tipo de diagnóstico',           
                  }
        }) }}
  </div>

    
  <div class="col-md-6">
    {{ form_row(form.solicitud) }}
  </div>

      
  <div class="col-md-6">
    {{ form_row(form.solicitud_complementaria) }}
  </div>
  
  <div class="col-md-6">
    {{ form_row(form.procedimiento) }}
  </div>
  
  <div class="col-md-6">
    {{ form_row(form.interconsulta) }}
  </div>
  </div>
  </br>


    <button class="btn btn-primary btn-block pull-left btn-smy">
    <i class="fas fa-save"></i> {{ button_label|default('Guardar') }}
    </button>
    </br>
{{ form_end(form) }}
 

   <div class="p-5 bg-white rounded shadow mb-5">
    <!-- Bordered tabs-->
    <ul id="myTab1" role="tablist" class="nav nav-tabs nav-pills with-arrow flex-column flex-sm-row text-center">
      <li class="nav-item flex-sm-fill">
        <a id="home1-tab" data-toggle="tab" href="#home1" role="tab" aria-controls="home1" aria-selected="true" class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 border active">Receta Médica</a>
      </li>
      <li class="nav-item flex-sm-fill">
        <a id="profile1-tab" data-toggle="tab" href="#profile1" role="tab" aria-controls="profile1" aria-selected="false" class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 border">Historial de Diagnósticos</a>
      </li>

        <li class="nav-item flex-sm-fill">
        <a id="contact1-tab" data-toggle="tab" href="#contact1" role="tab" aria-controls="contact1" aria-selected="false" class="nav-link text-uppercase font-weight-bold rounded-0 border">Pedidos de Exámenes</a>
      </li>

        <li class="nav-item flex-sm-fill">
        <a id="contact1-tab" data-toggle="tab" href="#contact2" role="tab" aria-controls="contact1" aria-selected="false" class="nav-link text-uppercase font-weight-bold rounded-0 border">Historial de Pedidos de Exámenes</a>
      </li>
    
    </ul>
    <div id="myTab1Content" class="tab-content">
      <div id="home1" role="tabpanel" aria-labelledby="home-tab" class="tab-pane fade px-4 py-5 show active">
        

  <div class="table-responsive">
    <table  id="example" style="width:100%" class="content-table table-sm">
        <thead>
            <tr>
                  <th>Diagnóstico CIE</th>
                  <th>Medicamentos</th>
                  <th>Presentación</th>
                  <th>Cantidad</th>
                  <th>Dosis</th>
                  <th>Frecuencia</th>
                  <th>Duración</th>
                  <th>Indicaciones</th>
                  
            </tr>
        </thead>
        <tbody id="articles">
        {% for diagnostico in antecedentes %}
            <tr>
                <td>{{diagnostico.codigo}}-{{ diagnostico.descripcion }} </br> Tipo de Diagnóstico:{{ diagnostico.tipo_diagnostico}}</br><a  href="{{ path('tratamiento_new', {p:diagnostico.PI ,d: diagnostico.id}) }}" title="Agregar Nuevo Tratamiento" style="font-size: 0.8em"><i class="fas fa-plus-square"></i></a><a  href=" {{ path('diagnostico_edit', {p:diagnostico.PI ,id:diagnostico.id, c:diagnostico.CI }) }}" title="Editar Diagnóstico" style="font-size: 0.8em"><i class="fas fa-edit"></i></a><a href="#"   title="Eliminar Diagnóstico" style="font-size: 0.8em"><i class="delete-article far fa-trash-alt" data-id="{{diagnostico.id}}" ></i></a></td>
                <td>{{ diagnostico.medicamento}}</td>
                <td>{{ diagnostico.presentacion}}</td>
                <td>{{ diagnostico.cantidad}}</td>
                <td>{{ diagnostico.dosis}}</td>
                <td>{{ diagnostico.frecuencia}}</td>
                <td>{{ diagnostico.duracion}}</td>
                <td>{{ diagnostico.indicaciones}}</td>
                
            </tr>
              {% if antecedentes is empty %}
            <tr>
                <td colspan="4">No Existen Registros</td>
            </tr>  
             {% endif %}
        {% endfor %}
        </tbody>
    </table>
  </div>
             

</div>
      <div id="profile1" role="tabpanel" aria-labelledby="profile-tab" class="tab-pane fade px-4 py-5">
          
        
        <div class="table-responsive">
    <table  id="example3" style="width:100%" class="content-table table-sm">
        <thead>
            <tr>  <th>Tipo de Consulta</th>
                  <th>Fecha Consulta</th>
                  <th>Diagnóstico CIE</th>
                  <th>Medicamentos</th>
                  <th>Presentación</th>
                  <th>Cantidad</th>
                  <th>Dosis</th>
                  <th>Frecuencia</th>
                  <th>Duración</th>
                  <th>Indicaciones</th>
                  
            </tr>
        </thead>
        <tbody id="articles">
        {% for diagnostico in antecedentes2 %}
            <tr>
                <td>{{ diagnostico.motivo_consulta}}</td>
                <td>{{ diagnostico.fecha_atencion ? diagnostico.fecha_atencion|date('Y-m-d') : '' }}</td>
                <td>{{diagnostico.codigo}}-{{ diagnostico.descripcion }} </br> Tipo de Diagnóstico:{{ diagnostico.tipo_diagnostico}}</td>
                <td>{{ diagnostico.medicamento}}</td>
                <td>{{ diagnostico.presentacion}}</td>
                <td>{{ diagnostico.cantidad}}</td>
                <td>{{ diagnostico.dosis}}</td>
                <td>{{ diagnostico.frecuencia}}</td>
                <td>{{ diagnostico.duracion}}</td>
                <td>{{ diagnostico.indicaciones}}</td>
                
            </tr>
             {% if antecedentes2 is empty %}
            <tr>
                <td colspan="4">No Existen Registros</td>
            </tr>  
             {% endif %}

        {% endfor %}
        </tbody>
    </table>
  </div>

      </div>


    <div id="contact1" role="tabpanel" aria-labelledby="contact-tab" class="tab-pane fade px-4 py-5">

         <div class="table-responsive">
  
    <table  id="example2" style="width:100%" class="content-table table-sm">
        <thead>
            <tr>
                  <th>Diagnóstico CIE</th>
                   <th>Exámenes de Laboratorio</th>
                  <th>Exámenes Complementarios</th>
                  <th>Fisioterapia</th>
                  <th>Interconsulta</th>   
            </tr>
        </thead>
        <tbody>
        {% for d in pedidos %}
            <tr>
                <td>{{d.codigo}}-{{ d.descripcion }}</td>
                <td>{{ d.solicitud|upper}}</td>
                <td>{{ d.solicitud_complementaria|upper}}</td>
                <td>{{ d.procedimiento|upper}}</td>
                <td>{{ d.interconsulta|upper}}</td>
                
            </tr>
         {% if pedidos is empty %}
            <tr>
                <td colspan="4">No Existen Registros</td>
            </tr>  
        {% endif %}

        {% endfor %}
        </tbody>
    </table>
  </div>

  
      </div>

        <div id="contact2" role="tabpanel" aria-labelledby="contact-tab" class="tab-pane fade px-4 py-5">

         <div class="table-responsive">
  
    <table  id="example5" style="width:100%" class="content-table table-sm">
        <thead>
            <tr>
                  <th>Tipo_Consulta</th>
                  <th>Fecha_Consulta</th>
                  <th>Diagnóstico CIE</th>
                   <th>Exámenes de Laboratorio</th>
                  <th>Exámenes Complementarios</th>
                  <th>Fisioterapia</th>
                  <th>Interconsulta</th>   
            </tr>
        </thead>
        <tbody>
        {% for d in pedidos2 %}
            <tr>
               <td>{{ d.motivo_consulta }}</td>
                <td>{{ d.fecha_atencion ? d.fecha_atencion|date('Y-m-d') : '' }}</td>
                <td>{{d.codigo}}-{{ d.descripcion }}</td>
                <td>{{ d.solicitud|upper}}</td>
                <td>{{ d.solicitud_complementaria|upper}}</td>
                <td>{{ d.procedimiento|upper}}</td>
                <td>{{ d.interconsulta|upper}}</td>
                
            </tr>
        {% if pedidos2 is empty %}
            <tr>
                <td colspan="4">No Existen Registros</td>
            </tr>  
        {% endif %}
           
        {% endfor %}
        </tbody>
    </table>
  </div>

  
      </div>
     
    </div>

    <!-- End bordered tabs -->
  </div>
  

</div>

{% endblock %}

{% block javascripts %}
   
  <script type="text/javascript">
        $(document).ready(function() {
          $('select[data-select="true"]').select2({
              minimumInputLength: 2,
             allowClear: true,
          });
        });
    </script>

      <script type="text/javascript"> 
     window.onload= function(){
       document.getElementById("op8").style="background-color: #FDF4BC;";
     }
 </script>


     <script> 
       $(document).ready(function() {

    

        $('#example').DataTable( {
            language: {
            url: 'https://cdn.datatables.net/plug-ins/1.10.22/i18n/Spanish.json'
        },

        "columnDefs": [{"targets": [0], "visible": false, }, ],
        "order": [[ 0, 'asc' ] != null , [ 1, 'asc' ]] != null,

           rowGroup: {
            dataSrc: [0]
        },

         dom: 'Bfrtip',
          buttons: [ {
        extend: 'print',
        title: '',
        text: " Imprimir Receta médica",
        footer: true,
       exportOptions: {
  grouped_array_index: [0],
  columns: [1, 2, 3, 4, 5, 6, 7],
  customizeData: function(data) {
    var filteredData = [];
    for (var i = 0; i < data.body.length; i++) {
      // Filtra los datos que tienen la columna 1 null
      if (data.body[i][0] != null) {
        filteredData.push(data.body[i]);
      }
    }
    // Vuelve a agrupar los datos por el valor de la primera columna
    var groupedData = [];
    var currentGroup = null;
    for (var i = 0; i < filteredData.length; i++) {
      var row = filteredData[i];
      if (row[0] !== currentGroup) {
        currentGroup = row[0];
        groupedData.push([currentGroup]);
      }
      groupedData[groupedData.length - 1].push(row.slice(1));
    }
    data.body = groupedData;
  }
},
            customize: function ( win ) {
                    $(win.document.body)
                        .css( 'font-size', '10pt' )
                        .prepend(
                          
                            '</br>  <div style="text-align: center"> <img src="https://i.ibb.co/RBZB7KQ/rlogo.png" alt="rlogo" border="0"> <h6 style="text-align: center">Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}  </h6> <h6 style="text-align: center">Especialidad: {{consulta.employed.Profesion }}</h6>  <h6 style="text-align: center">Unidad Operativa: {{consulta.employed.unidadesoperativas.nombre }}</h6> <h6 style="text-align: center">Dirección: {{consulta.employed.unidadesoperativas.direccion }}</h6></br>  </div> <h4 style="text-align: center"><b>RECETA MÉDICA</b></h4>  <h5>Paciente: <b>{{paciente.pnombre}} {{paciente.snombre}} {{paciente.papellido}} {{paciente.sapellido}}</b></h5> <h5>Cedula:<b>{{paciente.cedula}}</b></h5> <h5>Motivo de la Consulta: <b>{{ consulta.motivoconsulta }}</b></h5> <h5>Fecha de atención: <b>{{ consulta.fechaatencion  ? consulta.fechaatencion|date('Y-m-d') : '' }}</b></h5></br>'
                            
                        );
                  
 
                    $(win.document.body).find( 'table' )
                        .addClass( 'compact' )
                        .css( 'font-size', 'inherit','thead-dark','table' );
                     $(win.document.body).append(' </br></br></br></br></br></br></br></br></br></br></br></br><h6 class="text-center">_____________________________</h6><h6 class="text-center" > Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}</h6> <h6 class="text-center" >Medicina Ocupacional</h6>');
                }


            }  ],

          
         'responsive': true,
         
  } );


    } );

  
 </script>




     <script> 
       $(document).ready(function() {

        $('#example2').DataTable( {
            language: {
            url: 'https://cdn.datatables.net/plug-ins/1.10.22/i18n/Spanish.json'
        },

           dom: 'Bfrtip',
          buttons: [
         
              {
                extend: 'print',
                 title: '',
                text: "Exámenes de Laboratorio",
                footer: true,
                exportOptions: {
               columns: function(column, data, node) {
         if(column == 0){
              return true;
        }else if(column == 1){
             return true;
        }
        return false;
    },
                     rows: function ( idx, data, node ) {  
                          
                         return   data[0,1]  != '' ? true : false;

                        }
                    },
                customize: function ( win ) {
                    $(win.document.body)
                        .css( 'font-size', '10pt' )
                        .prepend(
                          
                            '</br>  <div style="text-align: center"> <img src="https://i.ibb.co/RBZB7KQ/rlogo.png" alt="rlogo" border="0"> <h6 style="text-align: center">Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}  </h6> <h6 style="text-align: center">Especialidad: {{consulta.employed.Profesion }}</h6>  <h6 style="text-align: center">Unidad Operativa: {{consulta.employed.unidadesoperativas.nombre }}</h6> <h6 style="text-align: center">Dirección: {{consulta.employed.unidadesoperativas.direccion }}</h6></br>  </div> <h4 style="text-align: center"><b>PEDIDO DE EXÁMENES DE LABORATORIO</b></h4>  <h5>Paciente: <b>{{paciente.pnombre}} {{paciente.snombre}} {{paciente.papellido}} {{paciente.sapellido}}</b></h5> <h5>Cedula:<b>{{paciente.cedula}}</b></h5> <h5>Motivo de la Consulta: <b>{{ consulta.motivoconsulta }}</b></h5> <h5>Fecha de atención: <b>{{ consulta.fechaatencion  ? consulta.fechaatencion|date('Y-m-d') : '' }}</b></h5></br>'
                            
                        );
                  
 
                    $(win.document.body).find( 'table' )
                        .addClass( 'compact' )
                        .css( 'font-size', 'inherit','thead-dark','table' );

                     $(win.document.body).append(' </br></br></br></br></br></br></br></br></br></br></br></br><h6 class="text-center">_____________________________</h6><h6 class="text-center" > Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}</h6> <h6 class="text-center" >Medicina Ocupacional</h6>');
                }
            },


             {
                extend: 'print',
                title: '',
                text: "Exámenes Complementarios",
                footer: true,
                exportOptions: {
                   columns: function(column, data, node) {
         if(column == 0){
              return true;
        }else if(column == 2){
             return true;
        }
        return false;
    },
                 rows: function ( idx, data, node ) {  
                          
                         return   data[0,2]  != '' ? true : false;

                        }
                    },
                customize: function ( win ) {
                    $(win.document.body)
                        .css( 'font-size', '10pt' )
                        .prepend(
                          
                            '</br>  <div style="text-align: center"> <img src="https://i.ibb.co/RBZB7KQ/rlogo.png" alt="rlogo" border="0"> <h6 style="text-align: center">Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}  </h6> <h6 style="text-align: center">Especialidad: {{consulta.employed.Profesion }}</h6>  <h6 style="text-align: center">Unidad Operativa: {{consulta.employed.unidadesoperativas.nombre }}</h6> <h6 style="text-align: center">Dirección: {{consulta.employed.unidadesoperativas.direccion }}</h6></br>  </div> <h4 style="text-align: center"><b>PEDIDO DE EXÁMENES COMPLEMENTARIOS</b></h4>  <h5>Paciente: <b>{{paciente.pnombre}} {{paciente.snombre}} {{paciente.papellido}} {{paciente.sapellido}}</b> <h5>Cedula:<b>{{paciente.cedula}}</b></h5> </h5> <h5>Motivo de la Consulta: <b>{{ consulta.motivoconsulta }}</b></h5> <h5>Fecha de atención: <b>{{ consulta.fechaatencion  ? consulta.fechaatencion|date('Y-m-d') : '' }}</b></h5></br>'
                            
                        );
                  
 
                    $(win.document.body).find( 'table' )
                        .addClass( 'compact' )
                        .css( 'font-size', 'inherit','thead-dark','table' );

                     $(win.document.body).append(' </br></br></br></br></br></br></br></br></br></br></br></br><h6 class="text-center">_____________________________</h6><h6 class="text-center" > Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}</h6> <h6 class="text-center" >Medicina Ocupacional</h6>');
                }
            },
            
             {
                extend: 'print',
                title: '',
                text: "Fisioterapia",
                footer: true,
                exportOptions: {
            

                     columns: function(column, data, node) {
         if(column == 0){
              return true;
        }else if(column == 3){
             return true;
        }
        return false;
    },
                   rows: function ( idx, data, node ) {  
                          
                         return   data[0,3]  != '' ? true : false;

                        }
                    },

                customize: function ( win ) {
                    $(win.document.body)
                        .css( 'font-size', '10pt' )
                        .prepend(
                          
                            '</br>  <div style="text-align: center"> <img src="https://i.ibb.co/RBZB7KQ/rlogo.png" alt="rlogo" border="0"> <h6 style="text-align: center">Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}  </h6> <h6 style="text-align: center">Especialidad: {{consulta.employed.Profesion }}</h6>  <h6 style="text-align: center">Unidad Operativa: {{consulta.employed.unidadesoperativas.nombre }}</h6> <h6 style="text-align: center">Dirección: {{consulta.employed.unidadesoperativas.direccion }}</h6></br>  </div> <h4 style="text-align: center"><b>PEDIDO DE FISIOTERAPIA</b></h4>  <h5>Paciente: <b>{{paciente.pnombre}} {{paciente.snombre}} {{paciente.papellido}} {{paciente.sapellido}}</b></h5> <h5>Cedula:<b>{{paciente.cedula}}</b></h5> <h5>Motivo de la Consulta: <b>{{ consulta.motivoconsulta }}</b></h5> <h5>Fecha de atención: <b>{{ consulta.fechaatencion  ? consulta.fechaatencion|date('Y-m-d') : '' }}</b></h5></br>'
                            
                        );
                  
 
                    $(win.document.body).find( 'table' )
                        .addClass( 'compact' )
                        .css( 'font-size', 'inherit','thead-dark','table' );

                     $(win.document.body).append(' </br></br></br></br></br></br></br></br></br></br></br></br><h6 class="text-center">_____________________________</h6><h6 class="text-center" > Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}</h6> <h6 class="text-center" >Medicina Ocupacional</h6>');
                }
            },

               {
                extend: 'print',
                title: '',
                text: "Interconsulta",
                footer: true,
                exportOptions: {
              
        columns: function(column, data, node) {
         if(column == 0){
              return true;
        }else if(column == 4){
             return true;
        }
        return false;
    },
                    rows: function ( idx, data, node ) {  
                          
                         return   data[0,4]  != '' ? true : false;

                        }
                    },
                customize: function ( win ) {
                    $(win.document.body)
                        .css( 'font-size', '10pt' )
                        .prepend(
                          
                            '</br>  <div style="text-align: center"> <img src="https://i.ibb.co/RBZB7KQ/rlogo.png" alt="rlogo" border="0"> <h6 style="text-align: center">Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}  </h6> <h6 style="text-align: center">Especialidad: {{consulta.employed.Profesion }}</h6>  <h6 style="text-align: center">Unidad Operativa: {{consulta.employed.unidadesoperativas.nombre }}</h6> <h6 style="text-align: center">Dirección: {{consulta.employed.unidadesoperativas.direccion }}</h6></br>  </div> <h4 style="text-align: center"><b>PEDIDO DE INTERCONSULTA</b></h4>  <h5>Paciente: <b>{{paciente.pnombre}} {{paciente.snombre}} {{paciente.papellido}} {{paciente.sapellido}}</b></h5> <h5>Cedula:<b>{{paciente.cedula}}</b></h5> <h5>Motivo de la Consulta: <b>{{ consulta.motivoconsulta }}</b></h5> <h5>Fecha de atención: <b>{{ consulta.fechaatencion  ? consulta.fechaatencion|date('Y-m-d') : '' }}</b></h5></br>'
                            
                        );
                  
 
                    $(win.document.body).find( 'table' )
                        .addClass( 'compact' )
                        .css( 'font-size', 'inherit','thead-dark','table' );

                     $(win.document.body).append(' </br></br></br></br></br></br></br></br></br></br></br></br><h6 class="text-center">_____________________________</h6><h6 class="text-center" > Dr/a: {{consulta.employed.Nombre }} {{consulta.employed.Apellido }}</h6> <h6 class="text-center" >Medicina Ocupacional</h6>');
                }
            },


            
        ],

         'responsive': true,
         
  } );


    } );

  
 </script>


  <script> 
       $(document).ready(function() {

        $('#example5').DataTable( {
            language: {
            url: 'https://cdn.datatables.net/plug-ins/1.10.22/i18n/Spanish.json'
        },
           
         'responsive': true,

            order:[1, 'desc'],
            columnDefs: [ {
            targets: [ 0 ],
            visible: false
        } ],
            rowGroup: {
            startRender: null,
            startRender: function ( rows, group ) {
                return group +' ('+rows.count()+')';
            },
            dataSrc: [0,1]
        },


       
        
         
  } );


    } );

  
 </script>

   <script> 
       $(document).ready(function() {

        $('#example3').DataTable( {
            language: {
            url: 'https://cdn.datatables.net/plug-ins/1.10.22/i18n/Spanish.json'
        },

        "columnDefs": [{"targets": [2], "visible": false, }, ],
        order: [[1, 'desc']],

           rowGroup: {
            dataSrc: [2]
        },

          
         'responsive': true,
         
  } );


    } );

  
 </script>




  

   




   <script>

  const articles = document.getElementById('articles');

   if (articles) {
     articles.addEventListener('click', e => {
       if (e.target.className === 'delete-article far fa-trash-alt') {
         if (confirm('Esta seguro de eliminar este elemento?')) {
              const value = e.target.getAttribute('data-id');
              let route = "{{ path('delate_diagnostico', { id: 'fileId_' }) }}";
              route = route.replace('fileId_', value);
   
           fetch(route, {
             method: 'DELETE'
           }).then(res => window.location.reload());
         }
       }
     });
   };
  </script>


  

   {% endblock %}

